<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ブロック崩しゲーム</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #222;
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .game-container {
            text-align: center;
        }
        
        #gameCanvas {
            border: 2px solid #fff;
            background-color: #000;
        }
        
        .controls {
            margin-top: 20px;
        }
        
        .score {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .instructions {
            margin-top: 10px;
            font-size: 14px;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="score">スコア: <span id="score">0</span></div>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div class="controls">
            <button id="startBtn">ゲーム開始</button>
            <button id="resetBtn">リセット</button>
        </div>
        <div class="instructions">
            左右矢印キーまたは A/D キーでパドルを操作
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');

        let gameRunning = false;
        let score = 0;

        const balls = [
            {
                x: canvas.width / 2 - 100,
                y: canvas.height - 50,
                dx: 3,
                dy: -3,
                radius: 8
            },
            {
                x: canvas.width / 2 - 50,
                y: canvas.height - 50,
                dx: 4,
                dy: -4,
                radius: 8
            },
            {
                x: canvas.width / 2,
                y: canvas.height - 50,
                dx: 5,
                dy: -5,
                radius: 8
            },
            {
                x: canvas.width / 2 + 50,
                y: canvas.height - 50,
                dx: 6,
                dy: -4,
                radius: 8
            },
            {
                x: canvas.width / 2 + 100,
                y: canvas.height - 50,
                dx: 7,
                dy: -3,
                radius: 8
            }
        ];

        const paddle = {
            x: canvas.width / 2 - 50,
            y: canvas.height - 20,
            width: 100,
            height: 10,
            speed: 16
        };

        const bricks = [];
        const brickRows = 6;
        const brickCols = 10;
        const brickWidth = canvas.width / brickCols;
        const brickHeight = 30;

        function initBricks() {
            bricks.length = 0;
            for (let row = 0; row < brickRows; row++) {
                for (let col = 0; col < brickCols; col++) {
                    bricks.push({
                        x: col * brickWidth,
                        y: row * brickHeight + 50,
                        width: brickWidth - 2,
                        height: brickHeight - 2,
                        color: `hsl(${row * 60}, 70%, 50%)`,
                        visible: true
                    });
                }
            }
        }

        function resetGame() {
            balls[0].x = canvas.width / 2 - 100;
            balls[0].y = canvas.height - 50;
            balls[0].dx = 3;
            balls[0].dy = -3;
            
            balls[1].x = canvas.width / 2 - 50;
            balls[1].y = canvas.height - 50;
            balls[1].dx = 4;
            balls[1].dy = -4;
            
            balls[2].x = canvas.width / 2;
            balls[2].y = canvas.height - 50;
            balls[2].dx = 5;
            balls[2].dy = -5;
            
            balls[3].x = canvas.width / 2 + 50;
            balls[3].y = canvas.height - 50;
            balls[3].dx = 6;
            balls[3].dy = -4;
            
            balls[4].x = canvas.width / 2 + 100;
            balls[4].y = canvas.height - 50;
            balls[4].dx = 7;
            balls[4].dy = -3;
            
            paddle.x = canvas.width / 2 - 50;
            score = 0;
            scoreElement.textContent = score;
            initBricks();
            gameRunning = false;
        }

        function drawBalls() {
            balls.forEach((ball, index) => {
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#ff9ff3', '#54a0ff'];
                ctx.fillStyle = colors[index];
                ctx.fill();
                ctx.closePath();
            });
        }

        function drawPaddle() {
            ctx.fillStyle = '#4ecdc4';
            ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
        }

        function drawBricks() {
            bricks.forEach(brick => {
                if (brick.visible) {
                    ctx.fillStyle = brick.color;
                    ctx.fillRect(brick.x, brick.y, brick.width, brick.height);
                }
            });
        }

        function moveBalls() {
            let activeBalls = 0;
            
            balls.forEach(ball => {
                if (ball.y + ball.radius <= canvas.height) {
                    activeBalls++;
                    
                    const isInLowerHalf = ball.y > canvas.height / 2;
                    const speedMultiplier = isInLowerHalf ? 0.5 : 1.0;
                    
                    ball.x += ball.dx * speedMultiplier;
                    ball.y += ball.dy * speedMultiplier;

                    if (ball.x + ball.radius > canvas.width || ball.x - ball.radius < 0) {
                        ball.dx = -ball.dx;
                    }

                    if (ball.y - ball.radius < 0) {
                        ball.dy = -ball.dy;
                    }

                    if (ball.y + ball.radius > paddle.y &&
                        ball.x > paddle.x &&
                        ball.x < paddle.x + paddle.width) {
                        ball.dy = -ball.dy;
                        const hitPos = (ball.x - paddle.x) / paddle.width;
                        ball.dx = (hitPos - 0.5) * 10;
                    }
                }
            });
            
            if (activeBalls === 0) {
                gameRunning = false;
                alert('ゲームオーバー！ スコア: ' + score);
            }
        }

        function checkBrickCollision() {
            bricks.forEach(brick => {
                if (brick.visible) {
                    balls.forEach(ball => {
                        if (ball.y + ball.radius <= canvas.height &&
                            ball.x > brick.x &&
                            ball.x < brick.x + brick.width &&
                            ball.y > brick.y &&
                            ball.y < brick.y + brick.height) {
                            ball.dy = -ball.dy;
                            brick.visible = false;
                            score += 10;
                            scoreElement.textContent = score;
                        }
                    });
                }
            });
            
            if (bricks.every(b => !b.visible)) {
                gameRunning = false;
                alert('おめでとうございます！全てのブロックを破壊しました！ スコア: ' + score);
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBricks();
            drawBalls();
            drawPaddle();
        }

        function gameLoop() {
            if (gameRunning) {
                moveBall();
                checkBrickCollision();
                draw();
                requestAnimationFrame(gameLoop);
            }
        }

        const keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        function updatePaddle() {
            if ((keys['ArrowLeft'] || keys['a'] || keys['A']) && paddle.x > 0) {
                paddle.x -= paddle.speed;
            }
            if ((keys['ArrowRight'] || keys['d'] || keys['D']) && paddle.x < canvas.width - paddle.width) {
                paddle.x += paddle.speed;
            }
        }

        function enhancedGameLoop() {
            if (gameRunning) {
                updatePaddle();
                moveBalls();
                checkBrickCollision();
                draw();
                requestAnimationFrame(enhancedGameLoop);
            }
        }

        startBtn.addEventListener('click', () => {
            if (!gameRunning) {
                gameRunning = true;
                enhancedGameLoop();
            }
        });

        resetBtn.addEventListener('click', resetGame);

        initBricks();
        draw();
    </script>
</body>
</html>